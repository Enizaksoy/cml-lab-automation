!
! Super-Spine-1 Configuration
! BGP EVPN VXLAN - 3-Tier Clos Topology
!

hostname Super-Spine-1

! Enable required features
feature bgp
feature interface-vlan
feature lacp
feature vpc
feature nv overlay

! Loopback for BGP Router-ID and peering
interface loopback0
  description BGP Router-ID
  ip address 10.0.0.1/32

! P2P Links to Spines
interface Ethernet1/1
  description To Spine-1 E1/5
  no switchport
  mtu 9216
  ip address 10.1.1.0/31
  no shutdown

interface Ethernet1/2
  description To Spine-2 E1/5
  no switchport
  mtu 9216
  ip address 10.1.1.2/31
  no shutdown

interface Ethernet1/3
  description To Spine-3 E1/5
  no switchport
  mtu 9216
  ip address 10.1.1.4/31
  no shutdown

interface Ethernet1/4
  description To Spine-4 E1/5
  no switchport
  mtu 9216
  ip address 10.1.1.6/31
  no shutdown

! BGP Configuration
router bgp 65000
  router-id 10.0.0.1
  bestpath as-path multipath-relax
  log-neighbor-changes
  address-family ipv4 unicast
    redistribute direct route-map PERMIT-ALL
    maximum-paths 64
  address-family l2vpn evpn
    retain route-target all

  ! BGP Neighbors - Spines (Underlay + Overlay)
  neighbor 10.1.1.1
    remote-as 65001
    description Spine-1
    update-source Ethernet1/1
    address-family ipv4 unicast
    address-family l2vpn evpn
      send-community extended
      route-map UNCHANGED out

  neighbor 10.1.1.3
    remote-as 65002
    description Spine-2
    update-source Ethernet1/2
    address-family ipv4 unicast
    address-family l2vpn evpn
      send-community extended
      route-map UNCHANGED out

  neighbor 10.1.1.5
    remote-as 65003
    description Spine-3
    update-source Ethernet1/3
    address-family ipv4 unicast
    address-family l2vpn evpn
      send-community extended
      route-map UNCHANGED out

  neighbor 10.1.1.7
    remote-as 65004
    description Spine-4
    update-source Ethernet1/4
    address-family ipv4 unicast
    address-family l2vpn evpn
      send-community extended
      route-map UNCHANGED out

! Route-maps
route-map PERMIT-ALL permit 10

route-map UNCHANGED permit 10
  set ip next-hop unchanged

end
